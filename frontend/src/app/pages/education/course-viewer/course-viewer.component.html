<div *ngIf="course" class="fixed inset-0 z-[60] bg-[#050508] animate-fade-in flex flex-col md:flex-row">
  <!-- Sidebar Navigation -->
  <div class="w-full md:w-80 border-r border-white/10 bg-[#0A0A0E] flex flex-col h-full">
    <div class="p-6 border-b border-white/10">
      <button (click)="onClose()" class="flex items-center gap-2 text-neutral-400 hover:text-white text-sm mb-4 transition-colors">
        <i class="bi bi-chevron-left text-base"></i> Back to Courses
      </button>
      <h2 class="text-lg font-bold text-white leading-tight">{{course.title}}</h2>
      <div class="mt-2 text-xs font-mono text-blue-400">{{currentModule + 1}} / {{course.modules.length}} COMPLETED</div>
      <div class="w-full h-1 bg-white/10 rounded-full mt-2 overflow-hidden">
         <div class="h-full bg-blue-500 transition-all duration-300" [style.width.%]="((currentModule+1)/course.modules.length)*100"></div>
      </div>
    </div>

    <div class="flex-grow overflow-y-auto py-4">
      <button
        *ngFor="let mod of course.modules; let idx = index"
        (click)="setCurrentModule(idx)"
        [ngClass]="{
          'w-full text-left px-6 py-4 flex items-start gap-3 hover:bg-white/5 transition-colors border-l-2': true,
          'border-blue-500 bg-blue-500/5': idx === currentModule,
          'border-transparent': idx !== currentModule
        }"
      >
        <div [ngClass]="{
          'mt-1 w-4 h-4 rounded-full border flex items-center justify-center': true,
          'border-blue-500 text-blue-500': idx === currentModule,
          'border-neutral-600 text-transparent': idx !== currentModule
        }">
          <div class="w-1.5 h-1.5 bg-current rounded-full"></div>
        </div>
        <div>
          <span class="text-xs text-neutral-500 font-mono block mb-1">MODULE 0{{idx + 1}}</span>
          <span [ngClass]="{'text-sm font-medium': true, 'text-white': idx === currentModule, 'text-neutral-400': idx !== currentModule}">
            {{mod.title}}
          </span>
        </div>
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="flex-grow overflow-y-auto h-full relative">
    <div class="max-w-3xl mx-auto px-8 py-12">
        <header class="mb-8 pb-8 border-b border-white/10">
            <span class="text-blue-400 font-mono text-sm">CHAPTER 0{{currentModule + 1}}</span>
            <h1 class="text-3xl md:text-4xl font-bold text-white mt-2">{{activeLesson?.title}}</h1>
        </header>

        <div class="prose prose-invert prose-lg max-w-none text-neutral-300">
            <p>
                Welcome to this module. In this section, we will explore how to interface directly with the browser's neural processing capabilities.
            </p>

            <h3 class="text-white font-bold mt-8">The Concept</h3>
            <p>
                Traditional web AI relied on server-side inference. Built-in AI flips this model, moving the model execution to the user's device.
            </p>

            <app-neo-graph type="flow"></app-neo-graph>

            <h3 class="text-white font-bold mt-8">Implementation</h3>
            <p>
                Here is how you initialize a session with the Prompt API. Note the use of `LanguageModel.create()`.
            </p>

            <app-neo-code title="app.js" language="javascript">
<!--{\`// Check availability-->
<!--const capabilities = await window.ai.languageModel.capabilities();-->

<!--if (capabilities.available === 'no') {-->
<!--  console.log("Built-in AI not supported");-->
<!--  return;-->
<!--}-->

<!--// Start a session-->
<!--const session = await window.ai.languageModel.create({-->
<!--  systemPrompt: "You are a helpful coding assistant."-->
<!--});-->

<!--// Stream response-->
<!--const stream = session.promptStreaming("Explain WebNN.");-->
<!--for await (const chunk of stream) {-->
<!--  console.log(chunk);-->
<!--}\`}-->
            </app-neo-code>

            <h3 class="text-white font-bold mt-8">System Architecture</h3>
            <p>The following diagram illustrates how the prompt travels through the IPC layer to the GPU process.</p>

            <app-neo-image caption="Chrome Process Isolation Model"></app-neo-image>

        </div>

        <!-- Footer Navigation -->
        <div class="mt-16 pt-8 border-t border-white/10 flex justify-between">
            <button
              [disabled]="currentModule === 0"
              (click)="setCurrentModule(currentModule - 1)"
              class="px-6 py-3 rounded-lg border border-white/10 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-white/5 flex items-center gap-2"
            >
                <i class="bi bi-chevron-left text-base"></i> Previous Lesson
            </button>
            <button
              [disabled]="currentModule === course.modules.length - 1"
              (click)="setCurrentModule(currentModule + 1)"
              class="px-6 py-3 rounded-lg bg-blue-600 text-white font-medium hover:bg-blue-500 transition-colors flex items-center gap-2"
            >
                Next Lesson <i class="bi bi-chevron-right text-base"></i>
            </button>
        </div>
    </div>
  </div>
</div>
